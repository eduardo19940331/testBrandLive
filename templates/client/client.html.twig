{% extends 'base.html.twig' %}

{% block title %}<h1>
    Administrador de Clientes /
    <small>Listado de Clientes</small>
</h1>{% endblock %}
{% block body %}

<div class="card text-white col-lg-12" style="padding: 0px">
    <div class="card-header bg-primary">
        Administrador de Clientes
        <div class="pull-right">
            <a href="{{ path('createclient') }}" type="button" class="btn btn-sm btn-primary"><i class="fa fa-users"></i> Nuevo Cliente</a>
        </div>
    </div>
    <div class="card-body text-black">
        <table id="table-list-clients" class="table">
            <thead>
                <tr>
                    <th class='text-center'>NOMBRE</th>
                    <th class='text-center'>APELLIDO</th>
                    <th class='text-center'>EMAIL</th>
                    <th class='text-center'>GRUPOS</th>
                    <th class='text-center'>ACCIONES</th>
                </tr>
            </thead>
            <tbody>
                {% for client in clients %}
                    <tr data-ident="{{ client.id }}">
                        <td class='text-center'>{{ client.firstname|default('') }}</td>
                        <td class='text-center'>{{ client.lastname|default('') }}</td>
                        <td class='text-center'>{{ client.email|default('') }}</td>
                        <td class='text-center'>{{ client.clientg|default('') }}</td>
                        <td class='text-center'>
                            <a href="{{ path('editclient', {id:client.id}) }}" class="btn btn-sm btn-success btn-edit"><i class="fa fa-edit"></i></a> 
                            <a class="btn btn-sm btn-danger btn-remove" data-ident="{{ client.id }}"><i class="fa fa-times"></i></a> 
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<div class="modal" id="modal-confirm-accion-client" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="titleConfirm">Eliminación de Cliente</h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <h5 id="textConfirm">¿Esta realmente seguro que desea eliminar el Cliente?</h5>
                <input type="hidden" id="identificateDeleted">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                <button type="button" id="textButtonConfirm" class="btn btn-primary btn-acept-remove-client">Si, Eliminar</button>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block javascripts %}
    <script>
        $(document).ready(function() {

        });

        $(document).on("click", ".btn-remove", function () {
            var ident = $(this).data("ident");
            $("#identificateDeleted").val(ident);
            $("#modal-confirm-accion-client").modal();
        });

        $("#textButtonConfirm").click(function () {
            var ident = $("#identificateDeleted").val();
            $.ajax({
                url : '{{ path('deletedclient') }}',
                data : { ident : ident },
                type : 'POST',
                success : function(json) {
                    if (json.state == "success") {
                        $("#modal-confirm-accion-client").modal('hide');
                        $(`[data-ident='${ident}'`).remove();
                        toast.success(json.message ?? 'Cliente eliminado correctamente', 'Exito!');
                    }
                },
                error : function(xhr, status) {
                    toast.error('Error!','Disculpe las molestias, existió un problema');
                },
                complete : function(xhr, status) {

                }
            });
        });
    </script>
{% endblock %}