{% extends 'base.html.twig' %}

{% block title %}<h1>
    Administrador de Clientes /
    <small>Listado de Clientes</small>
</h1>{% endblock %}
{% block body %}

<div class="card text-white col-lg-12" style="padding: 0px">
    <div class="card-header bg-primary">
        Datos de Cliente
        <div class="pull-right">
            <a href="{{ path('client') }}" type="button" class="btn btn-sm btn-primary"><i class="fa fa-arrow-left"></i> Todos los Usuarios</a>
        </div>
    </div>
    <div class="card-body text-black">
        <h5 class="card-title">Datos Ingresados</h5>
        <br>
        <form id="saveClient" action="{{ path('saveclient') }}" method="POST">
            <input type="hidden" id="ident" name="ident" value="{{ client.id|default('') }}" />
            <div class="form-row">
                <div class="form-group col-md-4">
                    <label for="first_name">Nombre</label>
                    <p class="form-control">{{ client.firstname|default('') }}</p>
                </div>
                <div class="form-group col-md-4">
                    <label for="lastname">Apellido</label>
                    <p class="form-control">{{ client.lastname|default('') }}</p>
                </div>
                <div class="form-group col-md-4">
                    <label for="email">Email</label>
                    <p class="form-control">{{ client.email|default('') }}</p>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group col-md-6">
                    <label for="description">Observaciones</label>
                    <p class="form-control" style="height: 90px;">{{ client.description|default('') }}</p>
                </div>
                <div class="form-group col-md-6">
                    <label for="gclient">Grupo de Cliente</label>
                    {% for groupId, groupName in groups %}
                        {% set isSelect = groupId in client.selectGroup|default([]) ? 'checked' %}
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="{{ groupId }}" id="gclient{{ groupId }}" name="gclient[{{ groupId }}]" {{ client.gclient|default(0) == 1 ? 'checked' }}  {{ isSelect }}>
                            <label class="form-check-label" for="gclient{{ groupId }}">
                                {{ groupName }}
                            </label>
                        </div>
                    {% endfor %}
                </div>
            </div>
        </form>
    </div>
    <div class="card-footer bg-primary">
        <div class="pull-right">
            <a href="{{ path('client') }}" type="button" class="btn btn-sm btn-primary"><i class="fa fa-arrow-left"></i> Todos los Usuarios</a>
        </div>
    </div>
</div>

{% endblock %}

{% block javascripts %}
<script>
    $("#saveClient").validate({
        rules: {
            firstname: {
                required: true,
                minlength: 3
            },
            lastname: {
                required: true,
                minlength: 3
            },
            email: {
                required: true,
                email: true
            },
            description: {
                required: true
            }
        },
        messages: {
            firstname: {
                required: "Ingrese el Nombre Valido",
                minlength: jQuery.validator.format("Debe Ingresar mas de {0} caracteres")
            },
            lastname: {
                required: "Ingrese un Apellido Valido",
                minlength: jQuery.validator.format("Debe Ingresar mas de {0} caracteres")
            },
            email: {
                required: "Ingrese Correo Valido",
                minlength: "Ingrese Correo Valido"
            },
            description: {
                required: "Ingrese NÃºmero de Telefono"
            }
        },
        // the errorPlacement has to take the table layout into account
        errorPlacement: function(error, element) {
            var hasError = 0;
            if (!element.val()) {
                if (element.is(":radio")) {
                    error.appendTo(element.parent().next().next());
                    hasError++;
                } else if (element.is(":checkbox")) {
                    error.appendTo(element.next());
                    hasError++;
                } else {
                    error.appendTo(element.parent());
                    hasError++;
                }
            }
            if (hasError > 0) {
                error.addClass("input-text-has-error");
                toastr.error("Favor completar todos los campos", "Ups!");
                element.addClass('hasError');
            }
        },
        submitHandler: function(form) {
            showChargePageLoad(true);
            $("#saveClient").submit();
        },
        // set this class to error-labels to indicate valid fields
        success: function(label) {
            label.html("&nbsp;").addClass("checked");
        },
        highlight: function(element, errorClass) {
            $(element).parent().next().find("." + errorClass).removeClass("checked");
        }
    });
</script>
{% endblock %}